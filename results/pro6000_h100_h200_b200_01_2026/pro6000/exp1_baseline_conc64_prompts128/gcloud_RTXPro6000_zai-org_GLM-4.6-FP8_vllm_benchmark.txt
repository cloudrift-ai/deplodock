============ Serving Benchmark Result ============
Successful requests:                     128       
Failed requests:                         0         
Maximum request concurrency:             64        
Benchmark duration (s):                  1679.68   
Total input tokens:                      1024000   
Total generated tokens:                  1024000   
Request throughput (req/s):              0.08      
Output token throughput (tok/s):         609.64    
Peak output token throughput (tok/s):    832.00    
Peak concurrent requests:                66.00     
Total token throughput (tok/s):          1219.28   
---------------Time to First Token----------------
Mean TTFT (ms):                          31173.80  
Median TTFT (ms):                        5595.31   
P99 TTFT (ms):                           113183.70 
-----Time per Output Token (excl. 1st token)------
Mean TPOT (ms):                          100.97    
Median TPOT (ms):                        104.20    
P99 TPOT (ms):                           104.55    
---------------Inter-token Latency----------------
Mean ITL (ms):                           100.96    
Median ITL (ms):                         91.32     
P99 ITL (ms):                            95.71     
----------------End-to-end Latency----------------
Mean E2EL (ms):                          838831.41 
Median E2EL (ms):                        837595.09 
P99 E2EL (ms):                           946731.37 
==================================================

============ Docker Compose Configuration ============
services:
  vllm_0:
    image: vllm/vllm-openai:latest
    container_name: vllm_benchmark_container_0
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    volumes:
      - /mnt/localssd/hf_models:/mnt/localssd/hf_models
    environment:
      - HUGGING_FACE_HUB_TOKEN=<REDACTED>
      - HF_HOME=/mnt/localssd/hf_models
    ports:
      - "8000:8000"
    shm_size: '16gb'
    ipc: host
    command: >
      --trust-remote-code
      --gpu-memory-utilization=0.9
      --host 0.0.0.0
      --port 8000
      --tensor-parallel-size 8
      --pipeline-parallel-size 1
      --model /mnt/localssd/hf_models/zai-org/GLM-4.6-FP8
      --served-model-name zai-org/GLM-4.6-FP8
      --max-num-seqs 256 --max-model-len 16384 --kv-cache-dtype fp8
    healthcheck:
      test: ["CMD", "bash", "-c", "curl -f http://localhost:8000/health && curl -f http://localhost:8000/v1/models | grep -q 'object.*list'"]
      interval: 10s
      timeout: 10s
      retries: 180
      start_period: 600s

  benchmark:
    image: vllm/vllm-openai:latest
    container_name: vllm_benchmark_client
    volumes:
      - /mnt/localssd/hf_models:/mnt/localssd/hf_models
    environment:
      - HUGGING_FACE_HUB_TOKEN=<REDACTED>
      - HF_HOME=/mnt/localssd/hf_models
    entrypoint: ["/bin/bash", "-c"]
    command: ["sleep infinity"]
    profiles:
      - tools

============ Benchmark Command ============
vllm bench serve     --model zai-org/GLM-4.6-FP8     --dataset-name random     --random-input-len 8000     --random-output-len 8000     --max-concurrency 64     --num-prompts 128     --ignore-eos     --backend openai-chat     --endpoint /v1/chat/completions     --percentile-metrics ttft,tpot,itl,e2el     --base-url http://vllm_0:8000
==================================================
